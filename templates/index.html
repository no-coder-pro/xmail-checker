<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gmail Checker Pro</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --gmail-red: #ea4335;
            --gmail-blue: #1a73e8;
            --gmail-green: #1e8e3e;
            --gmail-yellow: #fbbc04;
            --gmail-gray: #5f6368;
            --bg-color: #f6f8fc;
            --surface-color: #ffffff;
            --border-color: #dadce0;
            --primary: #1a73e8;
            --text-main: #202124;
            --border: #dadce0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: #202124;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            background: var(--surface-color);
            padding: 12px 24px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            color: #5f6368;
            font-weight: 700;
            /* Bold header text */
        }

        .logo svg {
            width: 32px;
            height: 32px;
        }

        /* Main Container */
        .container {
            max-width: 1000px;
            margin: 30px auto;
            padding: 0 20px;
            flex-grow: 1;
            width: 100%;
        }

        /* Input Card */
        .card {
            background: var(--surface-color);
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid transparent;
            transition: all 0.2s ease;
        }

        .card:hover {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h2 {
            font-size: 18px;
            font-weight: 400;
            color: var(--gmail-gray);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-group {
            position: relative;
            margin-bottom: 20px;
        }

        textarea {
            width: 100%;
            min-height: 150px;
            padding: 16px;
            font-family: 'Roboto', monospace;
            font-size: 14px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: #fff;
            color: #202124;
            resize: vertical;
            outline: none;
        }

        textarea:focus {
            border: 2px solid var(--gmail-blue);
            margin: -1px;
            /* preventing layout shift */
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 16px;
        }

        .btn {
            background-color: var(--gmail-blue);
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 4px;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background-color: #1765cc;
            box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3);
        }

        .btn:disabled {
            background-color: var(--border-color);
            cursor: not-allowed;
        }

        .btn-secondary {
            background-color: white;
            color: var(--gmail-gray);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background-color: #f8f9fa;
            color: #202124;
        }

        .options {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--gmail-gray);
            font-size: 14px;
            cursor: pointer;
        }

        /* Progress Bar */
        .progress-container {
            height: 4px;
            background: #e8eaed;
            width: 100%;
            overflow: hidden;
            border-radius: 2px;
            margin-top: 0;
            display: none;
        }

        .progress-bar {
            height: 100%;
            background: var(--gmail-blue);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Stats Section */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: white;
            padding: 16px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 400;
            color: #202124;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--gmail-gray);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-valid {
            border-left: 4px solid var(--gmail-green);
        }

        .stat-disabled {
            border-left: 4px solid var(--gmail-red);
        }

        .stat-unknown {
            border-left: 4px solid var(--gmail-yellow);
        }

        /* Results Table */
        .table-container {
            overflow-x: auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: white;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        th {
            text-align: left;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            color: var(--gmail-gray);
            font-weight: 500;
            background: #f8f9fa;
        }

        td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            color: #202124;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover {
            background-color: #f6f8fc;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-valid {
            background-color: #e6f4ea;
            color: var(--gmail-green);
        }

        .status-disabled,
        .status-invalid {
            background-color: #fce8e6;
            color: var(--gmail-red);
        }

        .status-unknown {
            background-color: #fef7e0;
            color: #b06000;
            /* Darker yellow/orange for text readability */
        }

        .hidden {
            display: none;
        }

        .toast {
            position: fixed;
            bottom: 24px;
            left: 24px;
            background: #323232;
            color: white;
            padding: 12px 24px;
            border-radius: 4px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }

        .toast.show {
            opacity: 1;
        }

        /* Footer */
        footer {
            background: #f1f3f4;
            padding: 40px 20px;
            text-align: center;
            border-top: 1px solid var(--border-color);
            margin-top: auto;
        }

        footer p {
            color: var(--text-main);
            margin: 5px 0;
        }

        /* Tabs Styling */
        .tab-bar {
            display: flex;
            gap: 12px;
            padding: 16px 24px;
            border-bottom: 1px solid #f1f3f4;
            overflow-x: auto;
            scrollbar-width: none;
            background: white;
            border-radius: 8px 8px 0 0;
        }

        .tab-bar::-webkit-scrollbar {
            display: none;
        }

        .tab {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 16px;
            background: #f8f9fa;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            font-size: 13px;
            color: var(--gmail-gray);
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s ease;
            user-select: none;
        }

        .tab:hover {
            background: #f1f3f4;
            border-color: #bdc1c6;
        }

        .tab.active {
            background: var(--gmail-blue);
            color: white;
            border-color: var(--gmail-blue);
            box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3);
        }

        .tab-count {
            background: rgba(0, 0, 0, 0.1);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 500;
        }

        .tab.active .tab-count {
            background: rgba(255, 255, 255, 0.2);
        }

        .tab-download {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-left: 4px;
            font-size: 12px;
            transition: background 0.2s;
            color: inherit;
        }

        .tab:not(.active) .tab-download:hover {
            background: #e8eaed;
            color: var(--gmail-blue);
        }

        .tab.active .tab-download:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .action-bar h2 {
            margin-bottom: 0;
        }
    </style>
</head>

<body>

    <header>
        <div class="logo">
            <!-- Gmail SVG Logo -->
            <svg viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M2 11.9556C2 8.47078 2 6.7284 2.67818 5.39739C3.27473 4.22661 4.22661 3.27473 5.39739 2.67818C6.7284 2 8.47078 2 11.9556 2H20.0444C23.5292 2 25.2716 2 26.6026 2.67818C27.7734 3.27473 28.7253 4.22661 29.3218 5.39739C30 6.7284 30 8.47078 30 11.9556V20.0444C30 23.5292 30 25.2716 29.3218 26.6026C28.7253 27.7734 27.7734 28.7253 26.6026 29.3218C25.2716 30 23.5292 30 20.0444 30H11.9556C8.47078 30 6.7284 30 5.39739 29.3218C4.22661 28.7253 3.27473 27.7734 2.67818 26.6026C2 25.2716 2 23.5292 2 20.0444V11.9556Z"
                    fill="white" />
                <path
                    d="M22.0515 8.52295L16.0644 13.1954L9.94043 8.52295V8.52421L9.94783 8.53053V15.0732L15.9954 19.8466L22.0515 15.2575V8.52295Z"
                    fill="#EA4335" />
                <path
                    d="M23.6231 7.38639L22.0508 8.52292V15.2575L26.9983 11.459V9.17074C26.9983 9.17074 26.3978 5.90258 23.6231 7.38639Z"
                    fill="#FBBC05" />
                <path
                    d="M22.0508 15.2575V23.9924H25.8428C25.8428 23.9924 26.9219 23.8813 26.9995 22.6513V11.459L22.0508 15.2575Z"
                    fill="#34A853" />
                <path d="M9.94811 24.0001V15.0732L9.94043 15.0669L9.94811 24.0001Z" fill="#C5221F" />
                <path
                    d="M9.94014 8.52404L8.37646 7.39382C5.60179 5.91001 5 9.17692 5 9.17692V11.4651L9.94014 15.0667V8.52404Z"
                    fill="#C5221F" />
                <path d="M9.94043 8.52441V15.0671L9.94811 15.0734V8.53073L9.94043 8.52441Z" fill="#C5221F" />
                <path
                    d="M5 11.4668V22.6591C5.07646 23.8904 6.15673 24.0003 6.15673 24.0003H9.94877L9.94014 15.0671L5 11.4668Z"
                    fill="#4285F4" />
            </svg>
            <span>Gmail Checker Pro</span>
        </div>
    </header>

    <div class="progress-container" id="progressContainer">
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <div class="container">

        <!-- Input Section -->
        <div class="card">
            <h2><i class="far fa-edit"></i> Compose List</h2>
            <div class="input-group">
                <textarea id="emailInput" placeholder="Enter Gmail addresses here (one per line)..."></textarea>
            </div>

            <div class="controls">
                <div class="options">
                    <label class="checkbox-wrapper">
                        <input type="checkbox" id="fastCheck"> Fast Check
                    </label>
                    <div id="countDisplay" style="font-size:13px; color:#5f6368">0 emails</div>
                </div>
                <button class="btn" id="checkBtn">
                    <i class="fas fa-paper-plane"></i> Verify
                </button>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden">

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="statTotal">0</div>
                    <div class="stat-label">Total Processed</div>
                </div>
                <div class="stat-card stat-valid">
                    <div class="stat-value" id="statValid" style="color:var(--gmail-green)">0</div>
                    <div class="stat-label">Valid</div>
                </div>
                <div class="stat-card stat-disabled">
                    <div class="stat-value" id="statDisabled" style="color:var(--gmail-red)">0</div>
                    <div class="stat-label">Disabled / Invalid</div>
                </div>
                <div class="stat-card stat-unknown">
                    <div class="stat-value" id="statUnknown" style="color:var(--gmail-yellow)">0</div>
                    <div class="stat-label">Unknown</div>
                </div>
            </div>

            <div class="card" style="padding:0">
                <div class="action-bar" style="padding:16px 24px; border-bottom:1px solid #f1f3f4; margin:0">
                    <h2><i class="fas fa-inbox"></i> Inbox Results</h2>
                    <button class="btn btn-secondary" id="downloadBtn">
                        <i class="fas fa-download"></i> Export All
                    </button>
                </div>

                <div id="tabBar" class="tab-bar">
                    <!-- Dynamic tabs will be injected here -->
                </div>

                <div class="table-container" style="border:none; border-radius:0 0 8px 8px">
                    <table id="resultsTable">
                        <thead>
                            <tr>
                                <th style="width: 50px">#</th>
                                <th>Email Address</th>
                                <th style="width: 150px">Status</th>
                                <th style="width: 200px">Timestamp</th>
                            </tr>
                        </thead>
                        <tbody id="resultsBody">
                            <!-- Rows will be injected here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>

    <div class="toast" id="toast"></div>

    <footer>
        <p>&copy; 2026 Gmail Checker API. All Rights Reserved</p>
        <p style="margin-top: 10px; font-size: 0.9rem;">Telegram:
            <a href="https://t.me/no_coder_xone" target="_blank"
                style="color: var(--primary); text-decoration: none; font-weight: 600;">No Coder Xone</a>
            <span style="margin: 0 8px; color: var(--border);">|</span>
            Developer: <span style="color: var(--text-main); font-weight: 600;">@no_coder_pro</span>
        </p>
    </footer>

    <script>
        const store = {
            results: [],
            currentFilter: 'all'
        };

        const els = {
            emailInput: document.getElementById('emailInput'),
            countDisplay: document.getElementById('countDisplay'),
            checkBtn: document.getElementById('checkBtn'),
            fastCheck: document.getElementById('fastCheck'),
            progressContainer: document.getElementById('progressContainer'),
            progressBar: document.getElementById('progressBar'),
            resultsSection: document.getElementById('resultsSection'),
            resultsBody: document.getElementById('resultsBody'),
            tabBar: document.getElementById('tabBar'),
            downloadBtn: document.getElementById('downloadBtn'),
            toast: document.getElementById('toast'),
            stats: {
                total: document.getElementById('statTotal'),
                valid: document.getElementById('statValid'),
                disabled: document.getElementById('statDisabled'),
                unknown: document.getElementById('statUnknown')
            }
        };

        // Auto-count emails
        els.emailInput.addEventListener('input', () => {
            const count = els.emailInput.value.split('\n').filter(l => l.trim()).length;
            els.countDisplay.textContent = `${count} emails`;
        });

        function showToast(msg) {
            els.toast.textContent = msg;
            els.toast.classList.add('show');
            setTimeout(() => els.toast.classList.remove('show'), 3000);
        }

        async function startVerification() {
            const rawText = els.emailInput.value;
            const mails = rawText.split('\n').map(l => l.trim()).filter(l => l && l.includes('@'));

            if (mails.length === 0) {
                showToast("Please enter valid email addresses.");
                return;
            }

            // UI Reset
            els.checkBtn.disabled = true;
            els.progressContainer.style.display = 'block';
            els.progressBar.style.width = '30%';
            els.resultsSection.classList.add('hidden');

            try {
                const response = await fetch('/api/check', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        mail: mails,
                        fastCheck: els.fastCheck.checked
                    })
                });

                els.progressBar.style.width = '70%';
                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Server error');
                }

                els.progressBar.style.width = '100%';
                store.results = data.results || [];
                renderResults();
                showToast(`Verification complete: ${store.results.length} processed.`);

            } catch (err) {
                showToast(`Error: ${err.message}`);
                els.progressBar.style.width = '0%';
            } finally {
                els.checkBtn.disabled = false;
                setTimeout(() => {
                    els.progressContainer.style.display = 'none';
                    els.progressBar.style.width = '0%';
                }, 500);
            }
        }

        function getStatusBadge(status) {
            const s = (status || 'Unknown').toLowerCase();

            // Green: Live, Valid
            if (s.includes('live') || s.includes('valid')) {
                return `<span class="status-badge status-valid">${status}</span>`;
            }

            // Red: Disabled, Does not exist, Unregistered, Invalid
            if (s.includes('disabled') || s.includes('exist') || s.includes('unregistered') || s.includes('invalid') || s.includes('error')) {
                return `<span class="status-badge status-disabled">${status}</span>`;
            }

            // Yellow: Verify, Unknown
            if (s.includes('verify') || s.includes('unknown')) {
                return `<span class="status-badge status-unknown">${status}</span>`;
            }

            // Default to unknown (Yellow)
            return `<span class="status-badge status-unknown">${status}</span>`;
        }

        function renderResults() {
            const { results, currentFilter } = store;

            // 1. Calculate stats (always based on total results)
            let counts = { valid: 0, disabled: 0, unknown: 0 };
            results.forEach(r => {
                const s = (r.status || '').toLowerCase();
                if (s.includes('live') || s.includes('valid')) counts.valid++;
                else if (s.includes('disabled') || s.includes('exist') || s.includes('unregistered') || s.includes('invalid') || s.includes('error')) counts.disabled++;
                else counts.unknown++;
            });

            els.stats.total.textContent = results.length;
            els.stats.valid.textContent = counts.valid;
            els.stats.disabled.textContent = counts.disabled;
            els.stats.unknown.textContent = counts.unknown;

            // 2. Render Tabs
            renderTabs();

            // 3. Filter results for table display
            const filteredResults = currentFilter === 'all'
                ? results
                : results.filter(r => (r.status || 'Unknown').toLowerCase() === currentFilter.toLowerCase());

            // 4. Render Table Body
            els.resultsBody.innerHTML = '';
            filteredResults.forEach((r, idx) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${idx + 1}</td>
                    <td>${r.email}</td>
                    <td>${getStatusBadge(r.status)}</td>
                    <td style="color:#5f6368; font-size:12px">${new Date(r.timestamp).toLocaleString()}</td>
                `;
                els.resultsBody.appendChild(tr);
            });

            els.resultsSection.classList.remove('hidden');
        }

        function renderTabs() {
            const { results, currentFilter } = store;
            els.tabBar.innerHTML = '';

            // Get unique statuses
            const uniqueStatuses = [...new Set(results.map(r => r.status || 'Unknown'))].sort();

            // Create 'All' tab
            els.tabBar.appendChild(createTab('All', 'all', results.length));

            // Create tabs for each status
            uniqueStatuses.forEach(status => {
                const count = results.filter(r => (r.status || 'Unknown') === status).length;
                els.tabBar.appendChild(createTab(status, status.toLowerCase(), count));
            });
        }

        function createTab(label, filterValue, count) {
            const tab = document.createElement('div');
            tab.className = `tab ${store.currentFilter === filterValue ? 'active' : ''}`;

            tab.innerHTML = `
                <span>${label}</span>
                <span class="tab-count">${count}</span>
                <span class="tab-download" title="Download ${label} CSV">
                    <i class="fas fa-download"></i>
                </span>
            `;

            tab.addEventListener('click', (e) => {
                const downloadBtn = e.target.closest('.tab-download');
                if (downloadBtn) {
                    downloadFilteredResults(filterValue);
                    e.stopPropagation();
                    return;
                }
                store.currentFilter = filterValue;
                renderResults();
            });

            return tab;
        }

        async function downloadFilteredResults(filterValue) {
            let filtered = store.results;
            if (filterValue !== 'all') {
                filtered = store.results.filter(r => (r.status || 'Unknown').toLowerCase() === filterValue);
            }

            if (!filtered.length) {
                showToast("No data to download");
                return;
            }

            try {
                const res = await fetch('/api/download', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ results: filtered })
                });

                const blob = await res.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${filterValue}_results_${new Date().getTime()}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                showToast(`${filterValue} CSV downloaded`);

            } catch (e) {
                showToast("Download failed");
            }
        }

        async function downloadCSV() {
            if (!store.results.length) return;

            try {
                const res = await fetch('/api/download', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ results: store.results })
                });

                const blob = await res.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `report_${new Date().getTime()}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);

            } catch (e) {
                showToast("Download failed");
            }
        }

        // Listeners
        els.checkBtn.addEventListener('click', startVerification);
        els.downloadBtn.addEventListener('click', downloadCSV);

    </script>
</body>

</html>
